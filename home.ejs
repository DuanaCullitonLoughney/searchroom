<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<!--  <link rel="stylesheet" href="style.css">-->
  <script src="index.js"></script>
  <title>Home</title>

  <!--    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">-->
<!--  Bootstrap-->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>
<!--  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">-->
<!--  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>-->

<!--  Needed for Contact Modal-->
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>


  <!--  Font Awesome-->
  <script src="https://kit.fontawesome.com/63302ef58e.js" crossorigin="anonymous"></script>

  <link rel="stylesheet" href="assets/fonts/font-awesome.min.css">
  <link rel="stylesheet" href="assets/fonts/ionicons.min.css">
  <link rel="stylesheet" type="text/css" href="assets/css/gradient-navbar-1.css">
  <link rel="stylesheet" type="text/css" href="assets/css/gradient-navbar.css">
  <link rel="stylesheet" type="text/css" href="assets/css/Navigation-with-Search.css">
  <link rel="stylesheet" type="text/css" href="assets/css/Off-Canvas-Sidebar-Drawer-Navbar.css">
<!--&lt;!&ndash;  <link rel="stylesheet" href="assets/css/style.css">&ndash;&gt;-->
<!--  <link rel="stylesheet" type="text/css" href="css/style.css">-->

  <!--Fix Favicon error-->
  <link rel="shortcut icon" href="#" />

</head>
<body style="background-color: #eaeaea;">
<nav class="navbar navbar-dark navbar-expand-md shadow" id="app-navbar">
  <div class="container-fluid"><button data-bs-toggle="collapse" class="navbar-toggler" data-bs-target="#navcol-2"><span class="visually-hidden">Toggle navigation</span><span class="navbar-toggler-icon"></span></button>
    <img src="Logo.png" style="max-height: 3em;">
    <button class="btn"><a href="/newroom" style="color: white"><b>Post a room</b></a></button>
    <button class="btn"><a href="/log" style="color: white"><b>Log in</b></a></button>

    <div class="collapse navbar-collapse" id="navcol-2">
      <ul class="navbar-nav ml-auto">
<!--        <li class="nav-item"><a class="nav-link active" href="account.html">Account</a></li>-->
      </ul>
    </div>
    <div class="d-flex align-items-center">
      <label class="form-label d-flex mb-0" for="search-field">

      </label>

      <form class="me-auto search-form" target="_self">
        <input id="search-field" class="form-control search-field" type="search" name="search" onkeyup="mySearchFunctions()"/>
      </form><a class="btn btn-light action-button" role="button" href="#"><i class="fa fa-search"></i></a>
    </div>
  </div>
</nav>

<!--<script src="assets/bootstrap/js/bootstrap.min.js"></script>-->
<script src="js/Off-Canvas-Sidebar-Drawer-Navbar.js"></script>
<script src="js/Off-Canvas-Sidebar-Drawer-Navbar-1.js"></script>

<section class="jumbotron" style="margin-top: -2em">
  <div class="card rounded-corners shadow" style="margin-bottom: 20px;">
    <article class="card-group-item">
      <header class="card-header" style="text-align: center">
        <h4 class="title">Range input </h4>
      </header>
      <div class="filter-content" style="margin-top: -1em;">
        <div class="card-body">
          <div class="form-row">
            <div class="form-group col-md-6">
              <label>Min</label>
              <input type="number" class="form-control" id="minValue" name="minValue" placeholder="€0" value="0">
            </div>
            <div class="form-group col-md-6 text-right">
              <label>Max</label>
              <input type="number" class="form-control" id="maxValue" placeholder="€1,000" name="maxValue" value="9999">
            </div>
          </div>
        </div> <!-- card-body.// -->
      </div>
    </article> <!-- card-group-item.// -->
    <button class="btn" onclick="checkRange()" style="margin-top: -1em">View rooms in range</button>
  </div>

  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script type="text/javascript">
    (function() {
      emailjs.init("user_kb0j1LeBTtvx42pguYLHy");
    })();
  </script>

  <div id = "int" class="rounded-corners shadow" style="padding: 5px; background-color: white">
    <!--<div id="sidebar">-->
    <!--  <h5 id="contactheader"style="font-size: 1.5rem; font-weight: 800; padding-bottom: 300;"><b>Contact The Seller</b></h5>-->
    <!--  <div class="toggle-btn" onclick ="show()">-->
    <!--    <div class="col-md-4">-->
    <!--      <button id="book" name="book" class="btn btn-primary"><h5>Contact Seller</h5></button>-->
    <!--    </div>-->
    <!--  </div>-->
    <!--  <input type="text" id="fromName" placeholder="Enter Name">-->
    <!--  <input type="text" id="fromEmail" placeholder="Enter Email">-->
    <!--  <textarea rows="4" cols="25" id="message" placeholder="Enter Message"></textarea>-->
    <!--  <button id="send" class="btn btn-primary" onclick='sendMail()'>Send Email</button>-->
    <!--</div>-->




<!--    <div class="card rounded-corners shadow" style="margin-bottom: 20px;">-->
<!--      <article class="card-group-item">-->
<!--        <header class="card-header" style="text-align: center">-->
<!--          <h4 class="title">Range input </h4>-->
<!--        </header>-->
<!--        <div class="filter-content" style="margin-top: -1em;">-->
<!--          <div class="card-body">-->
<!--            <div class="form-row">-->
<!--              <div class="form-group col-md-6">-->
<!--                <label>Min</label>-->
<!--                <input type="number" class="form-control" id="minValue" name="minValue" placeholder="€0" value="0">-->
<!--              </div>-->
<!--              <div class="form-group col-md-6 text-right">-->
<!--                <label>Max</label>-->
<!--                <input type="number" class="form-control" id="maxValue" placeholder="€1,000" name="maxValue" value="9999">-->
<!--              </div>-->
<!--            </div>-->
<!--          </div> &lt;!&ndash; card-body.// &ndash;&gt;-->
<!--        </div>-->
<!--      </article> &lt;!&ndash; card-group-item.// &ndash;&gt;-->
<!--      <button class="btn" onclick="checkRange()" style="margin-top: -1em">View rooms in range</button>-->
<!--    </div>-->

    <!--loops through every entry from the list passed in and adds them to page -->
    <% for( let room of list ){ %>

      <nav id = "main" class="room" style="margin-bottom: -0px; background-color:white;">
        <div class="row" style="padding: 20px;">

          <!-- Image of room - 33% width -->
          <div class="col-md-4" style="display: flex; justify-content: center; align-items: center;">
            <img src="<%=room.picture%>" class="rounded-corners shadow" alt="Room image" style="max-width: 100%; max-height:350px; width:100%" />
          </div>

          <!-- Details - 33% width -->
          <div class="col-md-4" style="text-align: center; display: flex; justify-content: center; align-content: center; flex-direction: column">
            <div class="intro">
              <h1><%= room.name %></h1>
              <p><%= room.details%></p>
              <h4><b class="rmPrice">€<%= room.price%></b> / month</h4>
              <br>

              <a class="btn btn-primary" role="button" href="/deleteroom/<%=room.id%>">Delete</a>

              <button class="btn btn-primary" onclick ="show()" data-toggle="modal" data-target=".bd-example-modal-lg">Contact Seller</button>

              <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg modal-dialog-centered">
                  <div class="card shadow modal-content rounded-corners" style="padding: 20px">
                    <h2> Contact Seller </h2>

                    <input type="text" id="fromName" class="form-control" placeholder="Enter Your Name">
                    <br>
                    <input type="text" id="fromEmail" class="form-control" placeholder="Enter Your Email">
                    <br>
                    <textarea  id="message" class="form-control" placeholder="Enter Your Message" style="height: 5em;"></textarea>
                    <br>
                    <button id="send" class="btn btn-primary" onclick='sendMail()' data-dismiss="modal">Send Email</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Google Maps - 33% width -->
          <div class="col-md-4 rounded-corners"><iframe class="rounded-corners shadow" allowfullscreen frameborder="0" src="https://www.google.com/maps/embed/v1/view?key=AIzaSyD-3-QEHpgnhneCKlo5-rnQPX_mOd9hmNo&amp;center=<%=room.latitude%>%2C<%=room.longitude%>&amp;zoom=16" loading="lazy" width="100%" height="100%" style="max-width: 100%;"></iframe></div>

        </div>
      </nav>
    <% } %>
  </div>
</section>



<script>
  function show() {
    document.getElementById('sidebar').classList.toggle('active');
  }

  /*email function*/
  function sendMail(params) {
    console.log("HELLO");
    var tempParams = {
      from_name: document.getElementById("fromName").value,
      from_email:document.getElementById("fromEmail").value,
      message: document.getElementById("message").value,
    };

    emailjs.send('service_zbmfupf','template_z4zis3x',tempParams)
            .then(function(res){
              console.log();
            })

    document.getElementById("fromName").value = "";
    document.getElementById("fromEmail").value = "";
    document.getElementById("message").value = "";

  }
  window.onload = mySearchFunctions();
  function mySearchFunctions() {
    // Declare variables
    var input, filter, ul, li, item, item2, i, txtValue, navtext;
    // User Input
    input = document.getElementById("search-field");
    // Filter, makes search not case sensitive
    filter = input.value.toLowerCase();
    // Grabs the parent element by id
    ul = document.getElementById("int");
    // Individual item on list
    li = ul.getElementsByTagName("h1");
    li1 = ul.getElementsByTagName("nav");
    // Treats lists items like an array, where each item can be accessed through it's index
    for (i = 0; i < li.length; i++) {
      item = li[i];
     // Iterate over each list item to see if the value of the input, ignoring case, matches the inner text or inner html of the item.
      txtValue = item.textContent || item.innerText;
      if (txtValue.toLowerCase().indexOf(filter) > -1) {
      // Displays list items that are a match, and nothing if no match
        li[i].style.display = "";
        li1[i].style.display = "";
      } 
      else {
        li[i].style.display = "none";
        li1[i].style.display = "none";
      }
    }
}
  // Checks whether rooms are in range entered by user, if not removes them from page
  function checkRange() {
    console.log('CHECKING RANGE');
    let min = document.getElementById("minValue").value;

    let max = document.getElementById("maxValue").value;
    console.log('MIN: ' + min + "   MAX: " + max);

    // Get list
    var rooms = document.getElementsByClassName("rmPrice");
    let length = rooms.length;
    console.log('Number of rooms: ' + length);

    // Loop through all prices
    for (var i = 0; i < length; i++) {
      let price = rooms[i].innerHTML; // Get price
      price = price.replace('€',''); // Remove € from string
      console.log("Price is: " + price + " min: "+ min + " max: "+ max);

      // If price is outside range
      if (price < min || price > max) {
        console.log("Shouldn't be shown. Price is: " + price + " min: "+ min + " max: "+ max);
        var parent = rooms[i]; // Get element
        for (var x = 0; x < 5; x++) { // Loop up through parents to get to rooms row
          if (parent.parentNode) {
            parent = parent.parentNode;
          }
        }
        parent.remove(); // Delete parent, removing row that held the room
        console.log("Parent removed")
      }
    }
  }

</script>

<script type ="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-analytics.js";

  import { getAuth, signInWithPopup, GoogleAuthProvider ,onAuthStateChanged,  signOut} from "https://www.gstatic.com/firebasejs/9.1.2/firebase-auth.js";

  var db=admin.database();

  // Your web app's Firebase configuration
  var firebaseConfig = {
    // Paste your Config Code

    apiKey: "AIzaSyApZIgN87Jy6iOjkmhk0QGkhDAHzgr4JhI",
    authDomain: "cs353-18d8f.firebaseapp.com",
    projectId: "cs353-18d8f",
    storageBucket: "cs353-18d8f.appspot.com",
    messagingSenderId: "100988194529",
    appId: "1:100988194529:web:7ff7397346fd01189231a0",
    measurementId: "G-F61ZBZGL76"

  };

  const app = initializeApp(firebaseConfig);
  document.getElementById('dashboard').style.display="none"
  const auth = getAuth();

  const provider = new GoogleAuthProvider();
  // const auth = getAuth();

  document.getElementById('logoutButton').addEventListener('click', LogoutUser)

  //checks if user is already logged in, user doesnt have to login in again

  function checkauthstate(){

    onAuthStateChanged(auth, (user) => {
      if (user) {
        //
        document.getElementById('LoginScreen').style.display="none"
        document.getElementById('dashboard').style.display="block"
        const uid = user.uid;
        console.log(user.email +'user is signed in' + uid)

      } else {
        // User is signed out

        console.log('user out')
      }

    });
  }

  //log out
  function LogoutUser(){
    console.log('Logout Btn Call')

    auth.signOut().then(()=>{

      console.log('logged out')
      document.getElementById('LoginScreen').style.display="block"
      document.getElementById('dashboard').style.display="none"

      //window.location.href="logout .html"; to move to different pages

    }).catch(e=>{
      console.log(e)
    })

  }

  checkauthstate()
</script>




<style>
  .rounded-corners{
    border-radius: 12px;
  }

  .shadow{
    box-shadow: 2px 2px 2px 2px rgba(0,0,0,0.1);
  }

  .form-control{
    border-radius: 8px !important;
    background: #f7f9fc;
    border: none;
    border-bottom: 1px solid #dfe7f1;
    border-radius: 0;
    box-shadow: none;
    outline: none;
    color: inherit;
    text-indent: 8px;
    height: 42px;
  }
</style>
</body>
</html>
